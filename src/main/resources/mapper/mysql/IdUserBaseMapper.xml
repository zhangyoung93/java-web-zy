<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zy.demo.dao.mysql.IdUserBaseMapper">
  <!--mapper维度开启二级缓存-->
  <cache eviction="LRU" flushInterval="60000" size="1024" readOnly="false"/>

  <resultMap id="BaseResultMap" type="com.zy.demo.model.IdUserBase">
    <id column="user_id" jdbcType="BIGINT" property="userId" />
    <result column="user_name" jdbcType="VARCHAR" property="userName" />
    <result column="full_name" jdbcType="VARCHAR" property="fullName" />
    <result column="mobile" jdbcType="CHAR" property="mobile" />
    <result column="id_card" jdbcType="CHAR" property="idCard" />
    <result column="sex" jdbcType="BOOLEAN" property="sex" />
    <result column="user_status" jdbcType="CHAR" property="userStatus" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
    <!--一对一关联查询-->
    <association property="idUserPwd" javaType="com.zy.demo.model.IdUserPwd">
        <id property="userPwdId" column="user_pwd_id"/>
        <result property="userPwd" column="user_pwd"/>
    </association>
    <!--一对一嵌套查询-->
    <association
        property="idUserPwd"
        select="com.zy.demo.dao.mysql.IdUserPwdMapper.selectByUserId"
        column="user_id"
        fetchType="lazy"/>
    <!--一对多关联查询-->
    <collection property="idUserJobList" ofType="com.zy.demo.model.IdUserJob">
        <id property="userJobId" column="user_job_id"/>
        <result property="jobType" column="job_type"/>
        <result property="jobName" column="job_name"/>
    </collection>
    <!--一对多嵌套查询-->
    <collection
        property="idUserJobList"
        select="com.zy.demo.dao.mysql.IdUserJobMapper.selectByUserId"
        column="user_id"
        fetchType="lazy"/>
  </resultMap>

  <parameterMap id="baseCondMap" type="com.zy.demo.model.IdUserBase">
    <parameter property="userId" jdbcType="BIGINT"/>
    <parameter property="userName" jdbcType="VARCHAR"/>
    <parameter property="fullName" jdbcType="VARCHAR"/>
    <parameter property="mobile" jdbcType="VARCHAR"/>
    <parameter property="idCard" jdbcType="VARCHAR"/>
    <parameter property="sex" jdbcType="BOOLEAN"/>
    <parameter property="userStatus" jdbcType="VARCHAR"/>
  </parameterMap>

  <sql id="Base_Column_List">
    user_id, user_name, full_name, mobile, id_card, sex, user_status, create_time, update_time
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from id_user_base
    where user_id = #{userId,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    delete from id_user_base
    where user_id = #{userId,jdbcType=BIGINT}
  </delete>
  <insert id="insert" keyColumn="user_id" keyProperty="userId" parameterType="com.zy.demo.model.IdUserBase" useGeneratedKeys="true">
    insert into id_user_base (user_name, full_name, mobile, 
      id_card, sex, user_status, 
      create_time, update_time)
    values (#{userName,jdbcType=VARCHAR}, #{fullName,jdbcType=VARCHAR}, #{mobile,jdbcType=CHAR}, 
      #{idCard,jdbcType=CHAR}, #{sex,jdbcType=BOOLEAN}, #{userStatus,jdbcType=CHAR}, 
      #{createTime,jdbcType=TIMESTAMP}, #{updateTime,jdbcType=TIMESTAMP})
  </insert>
  <insert id="insertSelective" keyColumn="user_id" keyProperty="userId" parameterType="com.zy.demo.model.IdUserBase" useGeneratedKeys="true">
    insert into id_user_base
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="userName != null">
        user_name,
      </if>
      <if test="fullName != null">
        full_name,
      </if>
      <if test="mobile != null">
        mobile,
      </if>
      <if test="idCard != null">
        id_card,
      </if>
      <if test="sex != null">
        sex,
      </if>
      <if test="userStatus != null">
        user_status,
      </if>
      <if test="createTime != null">
        create_time,
      </if>
      <if test="updateTime != null">
        update_time,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="userName != null">
        #{userName,jdbcType=VARCHAR},
      </if>
      <if test="fullName != null">
        #{fullName,jdbcType=VARCHAR},
      </if>
      <if test="mobile != null">
        #{mobile,jdbcType=CHAR},
      </if>
      <if test="idCard != null">
        #{idCard,jdbcType=CHAR},
      </if>
      <if test="sex != null">
        #{sex,jdbcType=BOOLEAN},
      </if>
      <if test="userStatus != null">
        #{userStatus,jdbcType=CHAR},
      </if>
      <if test="createTime != null">
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateTime != null">
        #{updateTime,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.zy.demo.model.IdUserBase">
    update id_user_base
    <set>
      <if test="userName != null">
        user_name = #{userName,jdbcType=VARCHAR},
      </if>
      <if test="fullName != null">
        full_name = #{fullName,jdbcType=VARCHAR},
      </if>
      <if test="mobile != null">
        mobile = #{mobile,jdbcType=CHAR},
      </if>
      <if test="idCard != null">
        id_card = #{idCard,jdbcType=CHAR},
      </if>
      <if test="sex != null">
        sex = #{sex,jdbcType=BOOLEAN},
      </if>
      <if test="userStatus != null">
        user_status = #{userStatus,jdbcType=CHAR},
      </if>
      <if test="createTime != null">
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateTime != null">
        update_time = #{updateTime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where user_id = #{userId,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.zy.demo.model.IdUserBase">
    update id_user_base
    set user_name = #{userName,jdbcType=VARCHAR},
      full_name = #{fullName,jdbcType=VARCHAR},
      mobile = #{mobile,jdbcType=CHAR},
      id_card = #{idCard,jdbcType=CHAR},
      sex = #{sex,jdbcType=BOOLEAN},
      user_status = #{userStatus,jdbcType=CHAR},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      update_time = #{updateTime,jdbcType=TIMESTAMP}
    where user_id = #{userId,jdbcType=BIGINT}
  </update>

    
  <select id="selectJointByOneToOne" parameterType="java.lang.Long" resultMap="BaseResultMap">
    select iub.user_id, iub.full_name, iup.user_pwd
    from id_user_base iub
    left join id_user_pwd iup on iub.user_id = iup.user_id
    where iub.user_id = #{userId,jdbcType=BIGINT}
  </select>

  <select id="selectNestByOneToOne" parameterType="java.lang.Long" resultMap="BaseResultMap">
    select user_id
    from id_user_base
    where user_id = #{userId,jdbcType=BIGINT}
  </select>

  <select id="selectJointByOneToMany" parameterType="java.lang.Long" resultMap="BaseResultMap">
    select iub.user_id, iub.full_name, iuj.job_id, iuj.job_name
    from id_user_base iub
    left join id_user_job iuj on iub.user_id = iuj.user_id
    where iub.user_id = #{userId,jdbcType=BIGINT}
  </select>

  <select id="selectNestByOneToMany" parameterType="java.lang.Long" resultMap="BaseResultMap">
        select user_id
        from id_user_base
        where user_id = #{userId,jdbcType=BIGINT}
    </select>

  <select id="selectByPaging" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from id_user_base
    <where>
      <if test="fullName != null">
        and full_name = #{fullName,jdbcType=VARCHAR}
      </if>
    </where>
  </select>
  
  <insert id="insertOne" parameterMap="baseCondMap">
    insert into id_user_base (user_id, user_name, full_name, mobile,
      id_card, sex, user_status)
    values (#{userId,jdbcType=BIGINT}, #{userName,jdbcType=VARCHAR}, #{fullName,jdbcType=VARCHAR}, #{mobile,jdbcType=CHAR},
      #{idCard,jdbcType=CHAR}, #{sex,jdbcType=BOOLEAN}, #{userStatus,jdbcType=CHAR})
  </insert>

  <insert id="insertBatch">
    insert into id_user_base (user_id, user_name, full_name, mobile, id_card, sex, user_status)
    values
    <foreach collection="list" item="item" separator=",">
      (#{userId,jdbcType=BIGINT}, #{userName,jdbcType=VARCHAR}, #{fullName,jdbcType=VARCHAR}, #{mobile,jdbcType=CHAR},
      #{idCard,jdbcType=CHAR}, #{sex,jdbcType=BOOLEAN}, #{userStatus,jdbcType=CHAR})
    </foreach>
  </insert>

  <select id="selectByIndex" resultMap="BaseResultMap">
    <bind name="attr" value="'%' + param1 + '%'"/>
    select
    <include refid="Base_Column_List" />
    from id_user_base
    <where>
      and full_name like #{attr}
      and user_name = #{param2}
    </where>
  </select>

  <select id="selectByMap" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from id_user_base
    <where>
      <choose>
        <when test="fullName != null and fullName != ''">
          and full_name = #{fullName}
        </when>
        <when test="userName != null and userName != ''">
          and user_name = #{userName}
        </when>
        <otherwise>
          and 1 = 1
        </otherwise>
      </choose>
    </where>
  </select>
</mapper>